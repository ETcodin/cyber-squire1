---
phase: 08-interactive-ui
plan: 02
type: execute
wave: 2
depends_on: [08-01]
files_created:
  - COREDIRECTIVE_ENGINE/workflows/button_templates.json

must_haves:
  truths:
    - "Yes/No buttons available for confirmations"
    - "Priority selector buttons (High/Medium/Low) available"
  artifacts:
    - path: "COREDIRECTIVE_ENGINE/workflows/button_templates.json"
      provides: "Reusable button template generators"
      contains: "Yes/No and Priority selector templates"
---

<objective>
Create reusable button templates for common interactive patterns.

Purpose: Standardize button UX across all workflows. Templates ensure consistent formatting, callbacks, and expiration handling.

Output: Utility workflow that generates button JSON for Telegram Send Message nodes.
</objective>

<execution_context>
@/Users/et/.claude/get-shit-done/workflows/execute-plan.md
@/Users/et/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/08-interactive-ui/08-01-SUMMARY.md
Telegram inline keyboards: https://core.telegram.org/bots/api#inlinekeyboardmarkup
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create button template workflow</name>
  <files>COREDIRECTIVE_ENGINE/workflows/button_templates.json</files>
  <action>
    Create n8n workflow with Execute Workflow trigger:

    Input parameters:
    - template_type: "yes_no" | "priority_selector" | "custom"
    - action_prefix: Action name for callback data (e.g., "confirm_scan")
    - params: Additional parameters to include in callback

    Output:
    - reply_markup: JSON object for Telegram inline keyboard

    This workflow can be called from any other workflow to generate buttons.

    Example usage:
    ```javascript
    // From parent workflow
    Execute Workflow: button_templates
    Input: {
      template_type: "yes_no",
      action_prefix: "confirm_scan",
      params: ["example.com"]
    }

    Output: {
      reply_markup: {
        inline_keyboard: [[
          {text: "‚úÖ Yes", callback_data: "yes_confirm_scan:example.com"},
          {text: "‚ùå No", callback_data: "no_confirm_scan:example.com"}
        ]]
      }
    }
    ```
  </action>
  <verify>
    # Test workflow execution
    # Verify reply_markup JSON generated correctly
  </verify>
  <done>Button template workflow structure created</done>
</task>

<task type="auto">
  <name>Task 2: Implement Yes/No template</name>
  <files>COREDIRECTIVE_ENGINE/workflows/button_templates.json</files>
  <action>
    Add Code node for yes_no template:

    ```javascript
    const { action_prefix, params = [] } = $input.item.json;

    const yesCallback = `yes_${action_prefix}${params.length ? ':' + params.join(':') : ''}`;
    const noCallback = `no_${action_prefix}${params.length ? ':' + params.join(':') : ''}`;

    return {
      reply_markup: {
        inline_keyboard: [
          [
            { text: "‚úÖ Yes", callback_data: yesCallback },
            { text: "‚ùå No", callback_data: noCallback }
          ]
        ]
      }
    };
    ```

    Visual layout:
    ```
    [ ‚úÖ Yes ] [ ‚ùå No ]
    ```

    Use cases:
    - Confirm destructive actions
    - Approve security scans
    - Confirm task completion
    - Verify user intent
  </action>
  <verify>
    # Test with action_prefix: "delete_task", params: ["123"]
    # Expected callbacks:
    # - yes_delete_task:123
    # - no_delete_task:123
  </verify>
  <done>Yes/No template generates confirmation buttons</done>
</task>

<task type="auto">
  <name>Task 3: Implement Priority Selector template</name>
  <files>COREDIRECTIVE_ENGINE/workflows/button_templates.json</files>
  <action>
    Add Code node for priority_selector template:

    ```javascript
    const { action_prefix, params = [] } = $input.item.json;

    const priorities = ['high', 'medium', 'low'];
    const buttons = priorities.map(priority => ({
      text: priority === 'high' ? 'üî¥ High' :
            priority === 'medium' ? 'üü° Medium' :
            'üü¢ Low',
      callback_data: `${action_prefix}:${priority}${params.length ? ':' + params.join(':') : ''}`
    }));

    return {
      reply_markup: {
        inline_keyboard: [buttons]
      }
    };
    ```

    Visual layout:
    ```
    [ üî¥ High ] [ üü° Medium ] [ üü¢ Low ]
    ```

    Use cases:
    - Set task priority
    - Set alert severity
    - Set urgency level
  </action>
  <verify>
    # Test with action_prefix: "set_priority", params: ["task_456"]
    # Expected callbacks:
    # - set_priority:high:task_456
    # - set_priority:medium:task_456
    # - set_priority:low:task_456
  </verify>
  <done>Priority selector template generates priority buttons</done>
</task>

<task type="auto">
  <name>Task 4: Add custom multi-row button support</name>
  <files>COREDIRECTIVE_ENGINE/workflows/button_templates.json</files>
  <action>
    Add Code node for custom template:

    Input format:
    ```json
    {
      "template_type": "custom",
      "buttons": [
        [
          {"text": "Option 1", "callback_data": "opt1"},
          {"text": "Option 2", "callback_data": "opt2"}
        ],
        [
          {"text": "Cancel", "callback_data": "cancel"}
        ]
      ]
    }
    ```

    This allows flexible layouts:
    ```
    [ Option 1 ] [ Option 2 ]
    [       Cancel        ]
    ```

    Use cases:
    - Multi-option menus
    - Tool selection
    - Custom confirmation flows
  </action>
  <verify>
    # Test custom template with 2 rows
    # Verify reply_markup matches input structure
  </verify>
  <done>Custom template supports flexible button layouts</done>
</task>

<task type="auto">
  <name>Task 5: Add URL button support</name>
  <files>COREDIRECTIVE_ENGINE/workflows/button_templates.json</files>
  <action>
    Add support for URL buttons (open links):

    ```javascript
    // URL button format
    {
      text: "View in Notion",
      url: "https://notion.so/task_123"
    }
    ```

    Combined with callback buttons:
    ```
    [ üî¥ High ] [ üü° Medium ] [ üü¢ Low ]
    [     View in Notion üîó         ]
    ```

    Use cases:
    - Link to Notion tasks
    - Link to GitHub issues
    - Link to external dashboards
    - Link to scan results

    Note: URL buttons don't trigger callbacks, they just open URLs
  </action>
  <verify>
    # Test mixed button types (callback + URL)
    # Click URL button should open browser
    # Click callback button should trigger workflow
  </verify>
  <done>URL buttons support external links</done>
</task>

</tasks>

<verification>
1. Test Yes/No template generates correct callbacks
2. Test Priority selector with 3 options
3. Test custom template with multi-row layout
4. Test URL button opens link correctly
5. Test combined callback + URL buttons
6. Verify button JSON compatible with Telegram API
</verification>

<success_criteria>
- Yes/No template generates confirmation buttons
- Priority selector generates 3 priority buttons
- Custom template supports flexible layouts
- URL buttons open external links
- All templates produce valid Telegram markup
</success_criteria>

<output>
After completion, create `.planning/phases/08-interactive-ui/08-02-SUMMARY.md`
</output>
