---
phase: 03-ai-routing-core
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json
  - COREDIRECTIVE_ENGINE/workflow_tool_system_status.json
  - COREDIRECTIVE_ENGINE/workflow_tool_create_task.json
  - COREDIRECTIVE_ENGINE/workflow_tool_security_scan.json
autonomous: true

must_haves:
  truths:
    - "Each tool workflow has a descriptive name and description for AI agent"
    - "Tool schemas clearly define WHEN the tool should be called"
    - "System Status tool is connected to Supervisor Agent"
  artifacts:
    - path: "COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json"
      provides: "Tool node definitions with clear descriptions"
      contains: "toolWorkflow"
    - path: "COREDIRECTIVE_ENGINE/workflow_tool_system_status.json"
      provides: "Callable system status workflow"
      contains: "toolWorkflowInput"
  key_links:
    - from: "Tool workflow nodes"
      to: "Supervisor Agent"
      via: "ai_tool connection"
      pattern: "toolWorkflow.*ai_tool"
---

<objective>
Define clear, descriptive tool schemas for all sub-workflows to help the AI Agent make accurate routing decisions based on user intent.

Purpose: Enable precise tool selection by providing the AI with comprehensive context about when and why to use each tool.

Output: All tool workflows connected to Supervisor Agent with optimized names and descriptions.
</objective>

<execution_context>
@/Users/et/.claude/get-shit-done/workflows/execute-plan.md
@/Users/et/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json
@COREDIRECTIVE_ENGINE/workflow_tool_system_status.json
@COREDIRECTIVE_ENGINE/workflow_tool_create_task.json
@COREDIRECTIVE_ENGINE/workflow_tool_security_scan.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create System Status tool node in Supervisor workflow</name>
  <files>COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json</files>
  <action>
    Add a new tool workflow node for the System Status tool:

    1. Add new node to workflow_supervisor_agent.json:
       - ID: "tool-system-status"
       - Name: "System Status Tool"
       - Type: "@n8n/n8n-nodes-langchain.toolWorkflow"
       - Position: [1240, 680] (in tool row with other tools)

    2. Configure tool schema:
       ```json
       {
         "parameters": {
           "name": "System_Status",
           "description": "Call this tool when the user wants to check infrastructure health, system status, or service availability. Use for queries about EC2, Docker containers, n8n, Ollama, PostgreSQL, disk space, memory usage, or general 'is everything running?' questions. Examples: 'check system health', 'how is the server', 'are all services up', 'system status report'.",
           "workflowId": {
             "__rl": true,
             "value": "SYSTEM_STATUS_WORKFLOW_ID",
             "mode": "id"
           }
         },
         "id": "tool-system-status",
         "name": "System Status Tool",
         "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
         "typeVersion": 1.1,
         "position": [1240, 680]
       }
       ```

    3. Add connection to Supervisor Agent:
       ```json
       "System Status Tool": {
         "ai_tool": [[{
           "node": "Supervisor Agent",
           "type": "ai_tool",
           "index": 0
         }]]
       }
       ```

    Note: The workflowId "SYSTEM_STATUS_WORKFLOW_ID" is a placeholder. It must be replaced with the actual workflow ID from n8n after importing workflow_tool_system_status.json.

    4. Update workflow metadata to reflect new tool:
       Add "System Status" to list of connected tools in meta.notes
  </action>
  <verify>
    # Check for System Status tool node
    grep -E "tool-system-status|System Status Tool" COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json

    # Verify tool description exists
    grep "infrastructure health" COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json

    # Count total tools (should be 3: ADHD, Finance, System Status)
    grep -c "toolWorkflow" COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json
  </verify>
  <done>
    System Status tool node added to Supervisor workflow with descriptive schema. Total tools: 3.
  </done>
</task>

<task type="auto">
  <name>Task 2: Optimize existing tool descriptions (ADHD Commander, Finance Manager)</name>
  <files>COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json</files>
  <action>
    Enhance the descriptions for ADHD Commander and Finance Manager tools to improve routing accuracy:

    1. Update ADHD Commander Tool description (id: "tool-adhd"):
       ```
       OLD: "Call this tool when the user needs help selecting a focus task, is experiencing analysis paralysis, or asks what they should work on. This queries their Notion task database and uses AI to select the highest-ROI task for the current time of day."

       NEW: "Call this tool when the user needs task prioritization, focus guidance, or help deciding what to work on. Use for queries about task selection, productivity, 'what should I do next', analysis paralysis, or requesting the highest-priority action. Examples: 'what's on my plate', 'give me a task', 'what should I focus on', 'I'm stuck'. Returns AI-selected task from Notion board with reasoning."
       ```

    2. Update Finance Manager Tool description (id: "tool-finance"):
       ```
       OLD: "Call this tool when the user mentions anything related to money, expenses, income, payments, AWS costs, subscriptions, or debt tracking. It categorizes the transaction and logs it to the financial ledger."

       NEW: "Call this tool for any financial tracking, transaction logging, or money-related queries. Use when user mentions expenses, income, payments, bills, subscriptions, debt status, or AWS costs. Examples: 'log $50 for groceries', 'paid rent', 'what's my debt status', 'track AWS bill'. Automatically categorizes and logs transactions to ledger."
       ```

    3. Ensure descriptions:
       - Start with WHEN to call (clear trigger conditions)
       - Include natural language examples (not just keywords)
       - Explain WHAT the tool returns/does
       - Use action-oriented language

    These improvements help the AI make better routing decisions by providing clear intent patterns.
  </action>
  <verify>
    # Check for enhanced ADHD Commander description
    grep "task prioritization" COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json

    # Check for enhanced Finance Manager description
    grep "financial tracking" COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json

    # Verify "Examples:" keyword exists in descriptions
    grep -c "Examples:" COREDIRECTIVE_ENGINE/workflow_supervisor_agent.json
    # Should return at least 3 (one per tool)
  </verify>
  <done>
    ADHD Commander and Finance Manager tool descriptions enhanced with clear trigger conditions and natural language examples.
  </done>
</task>

<task type="auto">
  <name>Task 3: Validate tool workflow structure (System Status, Create Task, Security Scan)</name>
  <files>
    COREDIRECTIVE_ENGINE/workflow_tool_system_status.json
    COREDIRECTIVE_ENGINE/workflow_tool_create_task.json
    COREDIRECTIVE_ENGINE/workflow_tool_security_scan.json
  </files>
  <action>
    Verify all tool workflows follow the correct LangChain tool structure:

    1. Check each workflow has required nodes:
       - Tool Input node (type: "@n8n/n8n-nodes-langchain.toolWorkflowInput")
       - Tool Output node (type: "@n8n/n8n-nodes-langchain.toolWorkflowOutput")
       - Business logic nodes in between

    2. Verify workflow_tool_system_status.json:
       - Has Tool Input ‚Üí Run System Checks ‚Üí Format Output ‚Üí Tool Output
       - Format Output returns structured response (not raw shell output)
       - No external API calls that could timeout

    3. Verify workflow_tool_create_task.json:
       - Check if this exists and is complete
       - If incomplete or missing, document need for Phase 9 (Core Tools)
       - Should connect to Notion API for task creation

    4. Verify workflow_tool_security_scan.json:
       - Check if this exists and is complete
       - If incomplete, document need for Phase 10 (Extended Tools)
       - Should have confirmation logic (destructive action)

    5. Document current tool workflow status:
       - Ready for integration: System Status
       - Pending completion: Create Task, Security Scan
       - Priority order: System Status (Phase 3) > Create Task (Phase 9) > Security Scan (Phase 10)

    For now, only System Status needs to be fully functional for Phase 3.
  </action>
  <verify>
    # Check all tool workflows exist
    ls -la COREDIRECTIVE_ENGINE/workflow_tool_*.json

    # Verify System Status has Tool Input/Output nodes
    grep -E "toolWorkflowInput|toolWorkflowOutput" COREDIRECTIVE_ENGINE/workflow_tool_system_status.json | wc -l
    # Should return 2 (one input, one output)

    # Check Create Task structure
    grep "toolWorkflowInput" COREDIRECTIVE_ENGINE/workflow_tool_create_task.json || echo "CREATE_TASK_INCOMPLETE"

    # Check Security Scan structure
    grep "toolWorkflowInput" COREDIRECTIVE_ENGINE/workflow_tool_security_scan.json || echo "SECURITY_SCAN_INCOMPLETE"
  </verify>
  <done>
    All tool workflows validated. System Status ready for integration. Create Task and Security Scan marked for future phases.
  </done>
</task>

<task type="auto">
  <name>Task 4: Create tool integration deployment guide</name>
  <files>.planning/phases/03-ai-routing-core/03-02-DEPLOYMENT.md</files>
  <action>
    Create deployment instructions for connecting tool workflows to the Supervisor Agent:

    1. Create file: `.planning/phases/03-ai-routing-core/03-02-DEPLOYMENT.md`

    2. Document the tool integration process:
       ```markdown
       # Phase 03-02 Tool Integration Deployment

       ## Overview
       This guide explains how to connect tool workflows to the Supervisor Agent in n8n.

       ## Prerequisites
       - n8n accessible at https://cyber-squire.tigouetheory.com
       - workflow_supervisor_agent.json updated with tool nodes
       - workflow_tool_system_status.json ready for import

       ## Deployment Steps

       ### 1. Import Tool Workflows
       1. Open n8n web interface
       2. Navigate to Workflows > Import from File
       3. Import in order:
          - `workflow_tool_system_status.json` ‚Üí Note the workflow ID
          - `workflow_tool_create_task.json` (if ready)
          - `workflow_tool_security_scan.json` (if ready)
       4. Activate each imported workflow

       ### 2. Update Supervisor Agent with Workflow IDs
       1. Open `workflow_supervisor_agent.json` in text editor
       2. Find tool node: `"id": "tool-system-status"`
       3. Replace placeholder workflow ID:
          ```json
          "workflowId": {
            "value": "ACTUAL_WORKFLOW_ID_FROM_N8N",
            "mode": "id"
          }
          ```
       4. Repeat for other tools (ADHD Commander, Finance Manager if IDs changed)

       ### 3. Re-import Supervisor Agent
       1. In n8n, update existing Supervisor Agent workflow (or delete and re-import)
       2. Verify all tool connections appear in the UI:
          - Look for connected nodes with tool icons
          - Check AI Agent node shows all tools in sidebar
       3. Activate workflow

       ### 4. Verification
       Send test message via Telegram:
       - "Check system health" ‚Üí Should trigger System Status tool
       - Check n8n execution history for successful tool call
       - Verify ROUTING_DECISION log entry appears

       ## Troubleshooting

       **Tool not appearing in AI Agent:**
       - Verify workflow ID is correct
       - Check ai_tool connection exists in JSON
       - Restart n8n if cached

       **Tool execution fails:**
       - Check tool workflow is activated
       - Verify Tool Input/Output nodes are connected
       - Review tool workflow execution logs

       ## Current Tool Status
       - ‚úÖ System Status: Ready for integration
       - ‚è≥ ADHD Commander: Already integrated (verify ID)
       - ‚è≥ Finance Manager: Already integrated (verify ID)
       - üîú Create Task: Pending Phase 9
       - üîú Security Scan: Pending Phase 10
       ```

    3. Reference this file in SUMMARY for manual deployment steps
  </action>
  <verify>
    test -f .planning/phases/03-ai-routing-core/03-02-DEPLOYMENT.md && echo "DEPLOYMENT_GUIDE_EXISTS"

    grep "Import Tool Workflows" .planning/phases/03-ai-routing-core/03-02-DEPLOYMENT.md
  </verify>
  <done>
    Deployment guide created with step-by-step tool integration instructions and troubleshooting tips.
  </done>
</task>

</tasks>

<verification>
1. System Status tool node added to Supervisor Agent workflow
2. ADHD Commander and Finance Manager descriptions enhanced
3. All tool workflows validated for correct structure
4. Deployment guide created with integration steps
</verification>

<success_criteria>
- SC-3.1 ENHANCED: System Status tool schema clearly defines health check use cases
- SC-3.2 ENHANCED: ADHD Commander description includes natural language examples
- All tool descriptions follow pattern: WHEN ‚Üí Examples ‚Üí WHAT
</success_criteria>

<output>
After completion, create `.planning/phases/03-ai-routing-core/03-02-SUMMARY.md`
</output>
