{
  "name": "12WY Commander vFinal",
  "nodes": [
    {
      "parameters": {
        "updates": ["message"],
        "additionalFields": {}
      },
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.1,
      "position": [240, 300],
      "webhookId": "12wy-commander-vFinal",
      "credentials": {
        "telegramApi": {
          "name": "Telegram Bot"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.message.text }}",
              "operation": "startsWith",
              "value2": "/focus"
            }
          ]
        }
      },
      "name": "Filter Command",
      "type": "n8n-nodes-base.filter",
      "typeVersion": 1,
      "position": [460, 300]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://cd-service-ollama:11434/api/generate",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"qwen2.5:7b\",\n  \"prompt\": \"Select ONE task for deep work. Example tasks: Lab Report (High, Tomorrow), Security Review (Med, 3 days). Respond JSON only: {\\\"task\\\": \\\"name\\\", \\\"reason\\\": \\\"why\\\", \\\"minutes\\\": 45}\",\n  \"stream\": false,\n  \"options\": { \"temperature\": 0.3, \"num_predict\": 150 }\n}",
        "options": {
          "timeout": 120000
        }
      },
      "name": "Ollama Select",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [680, 300]
    },
    {
      "parameters": {
        "jsCode": "const r = $input.first().json;\nconst chat = $('Telegram Trigger').first().json.message.chat.id;\nconst user = $('Telegram Trigger').first().json.message.from.username || 'User';\n\nlet task = {task: 'Deep Work', reason: 'Focus session', minutes: 45};\ntry {\n  const cleaned = (r.response || '{}').replace(/```json\\n?|```\\n?/g, '').trim();\n  task = JSON.parse(cleaned);\n} catch(e) {}\n\nconst sessions = 1;\nconst bar = 'â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘';\n\nconst msg = `ğŸ¯ *12WY COMMANDER vFinal*\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n*FOCUS TARGET*\\n*${task.task}*\\n\\nâ± Duration: ${task.minutes || 45} min\\n\\nğŸ§  *AI Reasoning*\\n_${task.reason || 'Selected for you.'}_\\n\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ“ˆ *LEAD MEASURE*\\n${bar} Session ${sessions}\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n\\n@${user}`;\n\nreturn { json: { chatId: chat, text: msg } };"
      },
      "name": "Format Message",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [900, 300]
    },
    {
      "parameters": {
        "chatId": "={{ $json.chatId }}",
        "text": "={{ $json.text }}",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "name": "Send Telegram",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [1120, 300],
      "credentials": {
        "telegramApi": {
          "name": "Telegram Bot"
        }
      }
    }
  ],
  "connections": {
    "Telegram Trigger": {
      "main": [[{ "node": "Filter Command", "type": "main", "index": 0 }]]
    },
    "Filter Command": {
      "main": [[{ "node": "Ollama Select", "type": "main", "index": 0 }]]
    },
    "Ollama Select": {
      "main": [[{ "node": "Format Message", "type": "main", "index": 0 }]]
    },
    "Format Message": {
      "main": [[{ "node": "Send Telegram", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "saveManualExecutions": true
  },
  "staticData": null,
  "tags": [{ "name": "12WY" }, { "name": "vFinal" }]
}
